function ColorPicker(id,skinPath,dropDownMenu,defaultColors){ this.IsIE=document.all? true : false; this.ID=id; this.SkinPath=skinPath+"Dial\x6f\x67s/"; this.DropDownMenu=dropDownMenu; this.ColorSampleElement=document.getElementById('M\x45NU_BUT\x54\117\x4e_SP\x41\116\x5f'+this.ID); this.DefaultColors=defaultColors; this.ItemsPerRow=6; this.CanAddCustomColor= true; this.CanAddHexColor= true; if (null!=this.DropDownMenu){ this.BuildColorTable( ); } this.SelectedColor=""; this.SelectColor(""); this.OnClientClick=null; }ColorPicker.prototype.SetColors= function (colorsArray){ this.DefaultColors=colorsArray; this.BuildColorTable( ); };ColorPicker.prototype.GetXImageUrl= function ( ){return "u\x72l("+this.SkinPath+"\x78.gif)"; };ColorPicker.prototype.Enable= function (isEnabled){if (null!=this.DropDownMenu){ this.DropDownMenu.Enable(isEnabled); }} ; ColorPicker.prototype.Toggle= function ( ){if (null!=this.DropDownMenu){ this.DropDownMenu.Toggle( ); }} ; ColorPicker.prototype.SelectColor= function (color,hide){color=this.ValidateColor(color); this.SelectedColor=color; if (null==hide)hide= true; if (hide && null!=this.DropDownMenu && this.DropDownMenu.IsVisible( )){ this.DropDownMenu.SetVisible( false); } this.OnChangeSelection( ); } ; ColorPicker.prototype.OnChangeSelection= function ( ){if (null!=this.DropDownMenu && null!=this.ColorSampleElement){if (""==this.SelectedColor){ this.ColorSampleElement.style.background=this.SelectedColor; this.ColorSampleElement.style.backgroundImage=this.GetXImageUrl( ); this.ColorSampleElement.style.backgroundPosition="center"; this.ColorSampleElement.style.backgroundRepeat="no-repe\x61t"; }else { this.ColorSampleElement.style.backgroundImage=""; this.ColorSampleElement.style.background=this.SelectedColor; }if (this.OnClientClick){ this.OnClientClick( ); }}} ; ColorPicker.prototype.BuildColorTable= function ( ){var table=document.getElementById("COLOR_\x54ABLE_"+this.ID); if (!table)return; var rowLength=table.rows.length; for (var i=0; i<rowLength; i++){table.deleteRow(0); }var oRow=null; var curRowItems=0; for (i=0; i<this.DefaultColors.length; i++){if (0==i%this.ItemsPerRow){oRow=table.insertRow(-1); curRowItems=0; }curRowItems++; var bgColor=this.DefaultColors[i]; this.AddColorCell(oRow,bgColor); }var cellsToAdd=this.ItemsPerRow-curRowItems-1; if (cellsToAdd>0){for (var i=0; i<=cellsToAdd; i++){var oCell=oRow.insertCell(oRow.cells.length); oCell.innerHTML="&\x6ebsp;&nbs\x70;"; }}if (this.CanAddCustomColor){if (this.IsIE)this.AddCustomColorIE(table); else this.AddHexColor(table,localization["Ad\x64Custom\x43olor"]); }if (this.IsIE && this.CanAddHexColor){var sAddHexColor=localization["\x41ddHexC\x6f\154\x6fr"]; if ("\x75nd\x65\146i\x6eed"==typeof sAddHexColor){sAddHexColor=localization["Add\x43ustomHe\x78Color"]; } this.AddHexColor(table,sAddHexColor); }if (this.IsIE)this.DropDownMenu.SetMenuInnerHtml(table.outerHTML); } ; ColorPicker.prototype.AddCustomColorIE= function (table){var onClickHandler=this.ID+".\x4fnAddCust\x6fmColorIE\x28)"; var l1="Add Cu\x73tom Col\x6fr..."; if (localization){l1=localization["\x41ddCu\x73\164\x6fmColor"]; }var cellInnerHTML="\x3cspan cl\x61\x73s\x3d\x27La\x62el\047>"+l1+"\x3c\057\x73\160\x61n>"+"\074\x6fbje\x63\x74 i\x64\075\x27DLG_SE\x4cECT_CO\x4c\117\x52_"+this.ID+"\x27 CLASSI\x44\075\x27clsid:\x33050f819\x2d98b5-1\x31cf-bb8\x32-00a\x6100bdc\x650b\047\040\x77idth=\x270px\047 heigh\x74=\047\x30p\x78\047\x3e\074\x2fo\x62ject>"; this.AddCustomColor(table,onClickHandler,cellInnerHTML); } ; ColorPicker.prototype.AddHexColor= function (table,label){var onClickHandler=this.ID+".OnA\x64dHexCol\x6fr()"; var cellInnerHTML="\x3cspan cl\x61\163\x73=\047\x4cabe\x6c\047\x3e"+label+"\x3c/span>"; this.AddCustomColor(table,onClickHandler,cellInnerHTML); } ; ColorPicker.prototype.AddCustomColor= function (table,onClickHandler,cellInnerHtml){var row=table.insertRow(-1); var cell=row.insertCell(row.cells.length); cell.colSpan=this.ItemsPerRow; cell.noWrap= true; cell.setAttribute("onmouseo\x76er","this.cl\x61\163s\x4eame = \x27\x4fve\x72\047"); cell.setAttribute("onmouseo\x75t","\x74his\x2e\143l\x61ssName \x3d \047\x27"); if (""!=onClickHandler)cell.setAttribute("\x6fn\x63\x6cic\x6b",onClickHandler); cell.innerHTML=cellInnerHtml; } ; ColorPicker.prototype.OnAddCustomColorIE= function ( ){var dlg=document.all["\x44LG_\x53\105\x4cECT_CO\x4cOR_"+this.ID]; if (!dlg)return; var color=dlg.ChooseColorDlg( ); color=this.ConvertColor(color); this.OnAddCustomColor(color); } ; ColorPicker.prototype.ValidateColor= function (color){if (null==color)return ""; var re=/\x52\x47\x42\x28\s*(\d{1,3})\s*\x2c\s*(\d{1,3})\s*\x2c\s*(\d{1,3})\s*\x29.*/i; color=color.replace(re, function ($0_match,i1,I1,o2){return toHex(i1)+toHex(I1)+toHex(o2); } ); if (color.charAt(0)!="\x23"){color="#"+color; }re=new RegExp("\x23[0-9a\x2d\146\x41-F]{6\x7d","\147\x69"); return re.exec(color)?color: ""; function toHex(O2){var l2=new Ektron.String(parseInt(O2,10).toString(16)); return l2.padLeft(2,"\x30"); }} ; ColorPicker.prototype.OnAddCustomColor= function (color){color=this.ValidateColor(color); this.SelectColor(color, true); if (""!=color)this.AddCustomColorToColorTable(color); } ; ColorPicker.prototype.AddCustomColorToColorTable= function (color){var table=document.getElementById("\103\x4fLOR_TA\x42LE_"+this.ID); if (!table)return; var custColorRow=null; var extraRowsCount=0; if (this.CanAddCustomColor)extraRowsCount++; if (this.CanAddHexColor)extraRowsCount++; if (table.rows.length>((this.DefaultColors.length/this.ItemsPerRow)+extraRowsCount)){var lastRow=table.rows[table.rows.length-1]; if (lastRow.cells.length<this.ItemsPerRow)custColorRow=lastRow; }if (!custColorRow)custColorRow=table.insertRow(-1); this.AddColorCell(custColorRow,color); if (this.IsIE)this.DropDownMenu.SetMenuInnerHtml(table.outerHTML); } ; ColorPicker.prototype.AddColorCell= function (row,color){var cell=row.insertCell(row.cells.length); cell.setAttribute("\x6fnmo\x75\x73eo\x76er","\x74\150\x69\163\x2e\143l\x61\163\x73Name =\x20\047\x4fver\047"); cell.setAttribute("\x6fnmou\x73\145\x6fut","\x74his.\x63\154\x61\163s\x4eame = \x27\047"); cell.setAttribute("\x6fnclick",this.ID+"\x2eSele\x63\164\x43\157l\x6fr(\047"+color+"\047)"); var colorBox=document.createElement("\x44IV"); colorBox.style.backgroundColor=color; if (""==color){cell.style.backgroundImage=this.GetXImageUrl( ); cell.style.backgroundRepeat="\156\x6f-r\x65\x70e\x61\164"; cell.style.backgroundPosition="c\x65nter"; }cell.appendChild(colorBox); } ; ColorPicker.prototype.OnAddHexColor= function ( ){var color=prompt(localization["\x50rompt\x43\157\x6cor"],"#"); this.OnAddCustomColor(color); } ; ColorPicker.prototype.ConvertColor= function (color){color=parseInt(color); color=color.toString(16); if (color.length<6){var sTempString="\x30000\x30\x30".substring(0,(6-color.length)); color="\x23"+sTempString.concat(color).toUpperCase( ); }else {color="\x23"+color.toUpperCase( ); }return color; } ; ColorPicker.prototype.Toggle= function ( ){if (null!=this.DropDownMenu){ this.DropDownMenu.Toggle( ); if (window.event){window.event.cancelBubble= true; }}} ;
