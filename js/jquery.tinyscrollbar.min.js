(function(b){function a(D,J){function k(){G.update();z();return G}function U(){var c=H.toLowerCase();L.obj.css(N,Q/B.ratio);I.obj.css(N,-Q);K.start=L.obj.offset()[N];B.obj.css(c,P[J.axis]);P.obj.css(c,P[J.axis]);L.obj.css(c,L[J.axis])}function z(){if(!O){L.obj.bind("mousedown",C);P.obj.bind("mouseup",q)}else{F.obj[0].ontouchstart=function(c){if(1===c.touches.length){C(c.touches[0]);c.stopPropagation()}}}if(J.scroll&&window.addEventListener){M[0].addEventListener("DOMMouseScroll",j,false);M[0].addEventListener("mousewheel",j,false)}else{if(J.scroll){M[0].onmousewheel=j}}}function C(c){b("body").addClass("noSelect");var d=parseInt(L.obj.css(N),10);K.start=R?c.pageX:c.pageY;A.start=d=="auto"?0:d;if(!O){b(document).bind("mousemove",q);b(document).bind("mouseup",e);L.obj.bind("mouseup",e)}else{document.ontouchmove=function(f){f.preventDefault();q(f.touches[0])};document.ontouchend=e}}function j(d){if(I.ratio<1){var f=d||window.event,c=f.wheelDelta?f.wheelDelta/120:-f.detail/3;Q-=c*J.wheel;Q=Math.min(I[J.axis]-F[J.axis],Math.max(0,Q));L.obj.css(N,Q/B.ratio);I.obj.css(N,-Q);if(J.lockscroll||Q!==I[J.axis]-F[J.axis]&&Q!==0){f=b.event.fix(f);f.preventDefault()}}}function q(c){if(I.ratio<1){if(J.invertscroll&&O){A.now=Math.min(P[J.axis]-L[J.axis],Math.max(0,A.start+(K.start-(R?c.pageX:c.pageY))))}else{A.now=Math.min(P[J.axis]-L[J.axis],Math.max(0,A.start+((R?c.pageX:c.pageY)-K.start)))}Q=A.now*B.ratio;I.obj.css(N,-Q);L.obj.css(N,A.now)}}function e(){b("body").removeClass("noSelect");b(document).unbind("mousemove",q);b(document).unbind("mouseup",e);L.obj.unbind("mouseup",e);document.ontouchmove=document.ontouchend=null}var G=this,M=D,F={obj:b(".viewport",D)},I={obj:b(".overview",D)},B={obj:b(".scrollbar",D)},P={obj:b(".track",B.obj)},L={obj:b(".thumb",B.obj)},R=J.axis==="x",N=R?"left":"top",H=R?"Width":"Height",Q=0,A={start:0,now:0},K={},O="ontouchstart"in document.documentElement;this.update=function(c){F[J.axis]=F.obj[0]["offset"+H];I[J.axis]=I.obj[0]["scroll"+H];I.ratio=F[J.axis]/I[J.axis];B.obj.toggleClass("disable",I.ratio>=1);P[J.axis]=J.size==="auto"?F[J.axis]:J.size;L[J.axis]=Math.min(P[J.axis],Math.max(0,J.sizethumb==="auto"?P[J.axis]*I.ratio:J.sizethumb));B.ratio=J.sizethumb==="auto"?I[J.axis]/P[J.axis]:(I[J.axis]-F[J.axis])/(P[J.axis]-L[J.axis]);Q=c==="relative"&&I.ratio<=1?Math.min(I[J.axis]-F[J.axis],Math.max(0,Q)):0;Q=c==="bottom"&&I.ratio<=1?I[J.axis]-F[J.axis]:isNaN(parseInt(c,10))?Q:parseInt(c,10);U()};return k()}b.tiny=b.tiny||{};b.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false}};b.fn.tinyscrollbar=function(d){var c=b.extend({},b.tiny.scrollbar.options,d);this.each(function(){b(this).data("tsb",new a(b(this),c))});return this};b.fn.tinyscrollbar_update=function(c){return b(this).data("tsb").update(c)}})(jQuery);